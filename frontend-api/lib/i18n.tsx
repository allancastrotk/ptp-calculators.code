import React, { createContext, useContext, useMemo, useState } from "react";

export type Language = "pt_BR" | "en_US" | "es_ES";

export type I18nContextValue = {
  language: Language;
  setLanguage: (lang: Language) => void;
  t: (key: string) => string;
};

const dictionaries: Record<Language, Record<string, string>> = {
  en_US: {
    appTitle: "PowerTunePro Calculators",
    unitLabel: "Unit",
    unitMetric: "Metric",
    unitImperial: "Imperial",
    measureLabel: "MEASURE",
    compressionLabel: "TAXA",
    compressionOn: "On",
    compressionOff: "Off",
    compressionSectionTitle: "Compression",
    chamberVolumeLabel: "Chamber volume",
    gasketThicknessLabel: "Gasket thickness",
    gasketBoreLabel: "Gasket bore",
    deckHeightLabel: "Deck height",
    pistonVolumeLabel: "Piston volume",
    exhaustPortHeightLabel: "Exhaust port height",
    transferPortHeightLabel: "Transfer port height",
    crankcaseVolumeLabel: "Crankcase volume",
    compressionRatioLabel: "Compression ratio",
    clearanceVolumeLabel: "Clearance volume",
    sweptVolumeLabel: "Swept volume",
    trappedVolumeLabel: "Trapped volume",
    crankcaseCompressionLabel: "Crankcase compression",
    unitLocked: "Unit system not applicable",
    unitOutputImperial: "Outputs in inches",
    loading: "Calculating...",
    errorTitle: "Something went wrong",
    footer: "PowerTunePro",
    displacement: "Displacement",
    rl: "R/L Ratio",
    sprocket: "Sprocket Ratio",
    tires: "Tire and Rim",
    placeholder: "UI will be wired next",
    calculate: "Calculate",
    calculateOriginal: "Calculate Original",
    calculateNew: "Calculate New",
    clear: "Clear",
    originalSection: "Original",
    newSection: "Modified",
    originalResultsTitle: "Original results",
    newResultsTitle: "New results",
    originalAssemblySection: "Original assembly",
    newAssemblySection: "New assembly",
    originalAssemblyResultsTitle: "Original assembly results",
    newAssemblyResultsTitle: "New assembly results",
    comparisonAssemblyTitle: "Assembly comparison",
    statusTitle: "Status",
    statusLabel: "Status",
    deltaDiffLabel: "Δ Difference",
    comparisonTitle: "Comparison",
    comparisonDeclaredTitle: "Comparison with Declared",
    comparisonNewTitle: "Comparison with New",
    comparisonStatusLabel: "Status",
    normalizedInputsTitle: "Normalized inputs (mm)",
    compareDeclaredLabel: "Declared displacement (optional)",
    compareDeclaredHelp: "Compare only. Does not change the calculation.",
    displacementCcLabel: "Displacement (cc)",
    displacementLabel: "Displacement",
    displacementLLabel: "Displacement (L)",
    displacementCiLabel: "Displacement (cu in)",
    geometryLabel: "Geometry",
    smoothnessLabel: "Smoothness",
    diffVsOriginalLabel: "Diff vs Original (%)",
    diffLabel: "Diff (%)",
    resultsTitle: "Results",
    rlRatioLabel: "R/L",
    rodStrokeLabel: "Rod/Stroke",
    sprocketRatioLabel: "Ratio",
    sprocketDiffPercentLabel: "Diff (%)",
    sprocketDiffLabel: "Diff",
    chainPitchLabel: "Chain pitch",
    chainLinksLabel: "Chain links",
    chainPitchPlaceholder: "Select...",
    chainLengthLabel: "Chain length",
    centerDistanceLabel: "Center distance",
    chainLengthDiffLabel: "Diff chain length",
    centerDistanceDiffLabel: "Diff center distance",
    tiresDiameterLabel: "Diameter",
    tiresWidthLabel: "Width",
    tiresDiffDiameterLabel: "Diff diameter",
    tiresDiffDiameterPercentLabel: "Diff diameter (%)",
    tiresDiffWidthLabel: "Diff width",
    tiresDiffWidthPercentLabel: "Diff width (%)",
    selectPlaceholder: "Select...",
    diffRlLabel: "Diff R/L (%)",
    diffDisplacementLabel: "Diff displacement (%)",
    differenceLabel: "Difference",
    tireRimDeltaLabel: "Tire vs rim delta",
    geometry_square: "Square",
    geometry_oversquare: "Oversquare",
    geometry_undersquare: "Undersquare",
    smoothness_rough: "Rough",
    smoothness_normal: "Normal",
    smoothness_smooth: "Smooth",
    compareHint: "Calculate the Original to see comparison",
    compareHintWidget: "Calculate the Original on this page to enable comparison.",
    pageIdMissing: "Host should provide pageId to enable comparison between widgets.",
    warmupMessage: "Warming up server... (first request may take a few seconds)",
    retryHint: "Please try again.",
    originalValueLabel: "Original",
    newValueLabel: "New",
    diffValueLabel: "Diff",
    diffPercentLabel: "Diff (%)",
    notApplicableLabel: "—",
    boreLabel: "Bore",
    strokeLabel: "Stroke",
    cylindersLabel: "Cylinders",
    baselineLabel: "Baseline cc (optional)",
    rodLengthLabel: "Rod length",
    sprocketLabel: "Front teeth",
    crownLabel: "Rear teeth",
    vehicleTypeLabel: "Vehicle type",
    rimLabel: "Rim",
    widthLabel: "Width",
    aspectLabel: "Aspect",
    rimWidthLabel: "Rim width (optional)",
    flotationLabel: "Flotation size (optional)",
    measureMetricLabel: "Metric",
    measureFlotationLabel: "Flotation",
    Car: "Car",
    Motorcycle: "Motorcycle",
    LightTruck: "Light Truck",
    TruckCommercial: "Truck (Commercial)",
    Kart: "Kart",
    Kartcross: "Kartcross",
    required: "Required",
  },
  pt_BR: {
    appTitle: "PowerTunePro Calculators",
    unitLabel: "Unidade",
    unitMetric: "Metrico",
    unitImperial: "Imperial",
    measureLabel: "MEDIDA",
    compressionLabel: "TAXA",
    compressionOn: "On",
    compressionOff: "Off",
    compressionSectionTitle: "Taxa de compressao",
    chamberVolumeLabel: "Volume da camara",
    gasketThicknessLabel: "Espessura da junta",
    gasketBoreLabel: "Diametro da junta",
    deckHeightLabel: "Deck height",
    pistonVolumeLabel: "Volume do pistao",
    exhaustPortHeightLabel: "Altura da janela de escape",
    transferPortHeightLabel: "Altura da janela de transferencia",
    crankcaseVolumeLabel: "Volume do carter",
    compressionRatioLabel: "Taxa de compressao",
    clearanceVolumeLabel: "Volume de folga",
    sweptVolumeLabel: "Volume varrido",
    trappedVolumeLabel: "Volume aprisionado",
    crankcaseCompressionLabel: "Taxa do carter",
    unitLocked: "Sistema nao aplicavel",
    unitOutputImperial: "Saida em polegadas",
    loading: "Calculando...",
    errorTitle: "Algo deu errado",
    footer: "PowerTunePro",
    displacement: "Cilindrada",
    rl: "Relacao R/L",
    sprocket: "Relacao Coroa-Pinhao",
    tires: "Aro e Pneu",
    placeholder: "UI sera conectada em breve",
    calculate: "Calcular",
    calculateOriginal: "Calcular Original",
    calculateNew: "Calcular Novo",
    clear: "Limpar",
    originalSection: "Original",
    newSection: "Novo",
    originalResultsTitle: "Resultados do Original",
    newResultsTitle: "Resultados do Novo",
    originalAssemblySection: "Conjunto Original",
    newAssemblySection: "Conjunto Novo",
    originalAssemblyResultsTitle: "Resultados do Conjunto Original",
    newAssemblyResultsTitle: "Resultados do Conjunto Novo",
    comparisonAssemblyTitle: "Comparacao entre os Conjuntos",
    statusTitle: "Status",
    statusLabel: "Status",
    deltaDiffLabel: "Δ Diferenca",
    comparisonTitle: "Comparacao",
    comparisonDeclaredTitle: "Comparacao com o Declarado",
    comparisonNewTitle: "Comparacao com o Novo",
    comparisonStatusLabel: "Status",
    normalizedInputsTitle: "Entradas normalizadas (mm)",
    compareDeclaredLabel: "Cilindrada declarada (opcional)",
    compareDeclaredHelp: "Apenas comparacao. Nao altera o calculo.",
    displacementCcLabel: "Cilindrada (cc)",
    displacementLabel: "Cilindrada",
    displacementLLabel: "Cilindrada (L)",
    displacementCiLabel: "Cilindrada (pol^3)",
    geometryLabel: "Geometria",
    smoothnessLabel: "Suavidade",
    diffVsOriginalLabel: "Diferenca vs Original (%)",
    diffLabel: "Diferenca (%)",
    resultsTitle: "Resultados",
    rlRatioLabel: "R/L",
    rodStrokeLabel: "Biela/Curso",
    sprocketRatioLabel: "Relacao",
    sprocketDiffPercentLabel: "Diferenca (%)",
    sprocketDiffLabel: "Diferenca",
    chainPitchLabel: "Passo da corrente",
    chainLinksLabel: "Numero de elos",
    chainPitchPlaceholder: "Selecione...",
    chainLengthLabel: "Comprimento da corrente",
    centerDistanceLabel: "Distancia entre eixos",
    chainLengthDiffLabel: "Dif. comprimento",
    centerDistanceDiffLabel: "Dif. distancia",
    tiresDiameterLabel: "Diametro",
    tiresWidthLabel: "Largura",
    tiresDiffDiameterLabel: "Dif. diametro",
    tiresDiffDiameterPercentLabel: "Dif. diametro (%)",
    tiresDiffWidthLabel: "Dif. largura",
    tiresDiffWidthPercentLabel: "Dif. largura (%)",
    selectPlaceholder: "Selecione...",
    diffRlLabel: "Diferenca R/L (%)",
    diffDisplacementLabel: "Diferenca deslocamento (%)",
    differenceLabel: "Diferenca",
    tireRimDeltaLabel: "Diferenca pneu/aro",
    geometry_square: "Quadrado",
    geometry_oversquare: "Superquadrado",
    geometry_undersquare: "Subquadrado",
    smoothness_rough: "Aspero",
    smoothness_normal: "Normal",
    smoothness_smooth: "Suave",
    compareHint: "Calcule o Original para ver comparacao",
    compareHintWidget: "Calcule o Original nesta pagina para habilitar a comparacao.",
    pageIdMissing: "O host deve fornecer pageId para habilitar comparacao entre widgets.",
    warmupMessage: "Aguardando servidor... (primeiro acesso pode demorar alguns segundos)",
    retryHint: "Tente novamente.",
    originalValueLabel: "Original",
    newValueLabel: "Novo",
    diffValueLabel: "Diferenca",
    diffPercentLabel: "Diferenca (%)",
    notApplicableLabel: "—",
    boreLabel: "Diametro",
    strokeLabel: "Curso",
    cylindersLabel: "Cilindros",
    baselineLabel: "Base cc (opcional)",
    rodLengthLabel: "Comprimento da biela",
    sprocketLabel: "Dentes dianteiro",
    crownLabel: "Dentes traseiro",
    vehicleTypeLabel: "Tipo de veiculo",
    rimLabel: "Aro",
    widthLabel: "Largura",
    aspectLabel: "Perfil",
    rimWidthLabel: "Tala do aro (opcional)",
    flotationLabel: "Medida flotation (opcional)",
    measureMetricLabel: "Metrico",
    measureFlotationLabel: "Flotation",
    Car: "Carro",
    Motorcycle: "Moto",
    LightTruck: "SUV/Picape/Van",
    TruckCommercial: "Caminhao Comercial",
    Kart: "Kart",
    Kartcross: "Kartcross",
    required: "Obrigatorio",
  },
  es_ES: {
    appTitle: "PowerTunePro Calculators",
    unitLabel: "Unidad",
    unitMetric: "Metrico",
    unitImperial: "Imperial",
    measureLabel: "MEDIDA",
    compressionLabel: "TAXA",
    compressionOn: "On",
    compressionOff: "Off",
    compressionSectionTitle: "Compresion",
    chamberVolumeLabel: "Volumen de camara",
    gasketThicknessLabel: "Espesor de junta",
    gasketBoreLabel: "Diametro de junta",
    deckHeightLabel: "Deck height",
    pistonVolumeLabel: "Volumen de piston",
    exhaustPortHeightLabel: "Altura de escape",
    transferPortHeightLabel: "Altura de transferencia",
    crankcaseVolumeLabel: "Volumen de carter",
    compressionRatioLabel: "Relacion de compresion",
    clearanceVolumeLabel: "Volumen de holgura",
    sweptVolumeLabel: "Volumen barrido",
    trappedVolumeLabel: "Volumen atrapado",
    crankcaseCompressionLabel: "Compresion del carter",
    unitLocked: "Sistema no aplicable",
    unitOutputImperial: "Salida en pulgadas",
    loading: "Calculando...",
    errorTitle: "Algo salio mal",
    footer: "PowerTunePro",
    displacement: "Cilindrada",
    rl: "Relacion R/L",
    sprocket: "Relacion Corona-Pinon",
    tires: "Llanta y Neumatico",
    placeholder: "La UI se conectara pronto",
    calculate: "Calcular",
    calculateOriginal: "Calcular Original",
    calculateNew: "Calcular Nuevo",
    clear: "Limpiar",
    originalSection: "Original",
    newSection: "Nuevo",
    originalResultsTitle: "Resultados del Original",
    newResultsTitle: "Resultados del Nuevo",
    originalAssemblySection: "Conjunto Original",
    newAssemblySection: "Conjunto Nuevo",
    originalAssemblyResultsTitle: "Resultados del Conjunto Original",
    newAssemblyResultsTitle: "Resultados del Conjunto Nuevo",
    comparisonAssemblyTitle: "Comparacion entre Conjuntos",
    statusTitle: "Estado",
    statusLabel: "Estado",
    deltaDiffLabel: "Δ Diferencia",
    comparisonTitle: "Comparacion",
    comparisonDeclaredTitle: "Comparacion con el Declarado",
    comparisonNewTitle: "Comparacion con el Nuevo",
    comparisonStatusLabel: "Estado",
    normalizedInputsTitle: "Entradas normalizadas (mm)",
    compareDeclaredLabel: "Cilindrada declarada (opcional)",
    compareDeclaredHelp: "Solo comparacion. No cambia el calculo.",
    displacementCcLabel: "Cilindrada (cc)",
    displacementLabel: "Cilindrada",
    displacementLLabel: "Cilindrada (L)",
    displacementCiLabel: "Cilindrada (pulg^3)",
    geometryLabel: "Geometria",
    smoothnessLabel: "Suavidad",
    diffVsOriginalLabel: "Diferencia vs Original (%)",
    diffLabel: "Diferencia (%)",
    resultsTitle: "Resultados",
    rlRatioLabel: "R/L",
    rodStrokeLabel: "Biela/Carrera",
    sprocketRatioLabel: "Relacion",
    sprocketDiffPercentLabel: "Diferencia (%)",
    sprocketDiffLabel: "Diferencia",
    chainPitchLabel: "Paso de la cadena",
    chainLinksLabel: "Numero de eslabones",
    chainPitchPlaceholder: "Seleccionar...",
    chainLengthLabel: "Longitud de la cadena",
    centerDistanceLabel: "Distancia entre ejes",
    chainLengthDiffLabel: "Dif. longitud",
    centerDistanceDiffLabel: "Dif. distancia",
    tiresDiameterLabel: "Diametro",
    tiresWidthLabel: "Ancho",
    tiresDiffDiameterLabel: "Dif. diametro",
    tiresDiffDiameterPercentLabel: "Dif. diametro (%)",
    tiresDiffWidthLabel: "Dif. ancho",
    tiresDiffWidthPercentLabel: "Dif. ancho (%)",
    selectPlaceholder: "Seleccionar...",
    diffRlLabel: "Diferencia R/L (%)",
    diffDisplacementLabel: "Diferencia desplazamiento (%)",
    differenceLabel: "Diferencia",
    tireRimDeltaLabel: "Diferencia neumatico/llanta",
    geometry_square: "Cuadrado",
    geometry_oversquare: "Supercuadrado",
    geometry_undersquare: "Subcuadrado",
    smoothness_rough: "Aspero",
    smoothness_normal: "Normal",
    smoothness_smooth: "Suave",
    compareHint: "Calcule el Original para ver comparacion",
    compareHintWidget: "Calcula el Original en esta pagina para habilitar la comparacion.",
    pageIdMissing: "El host debe proporcionar pageId para habilitar la comparacion entre widgets.",
    warmupMessage: "Activando servidor... (la primera solicitud puede tardar unos segundos)",
    retryHint: "Intentalo de nuevo.",
    originalValueLabel: "Original",
    newValueLabel: "Nuevo",
    diffValueLabel: "Diferencia",
    diffPercentLabel: "Diferencia (%)",
    notApplicableLabel: "—",
    boreLabel: "Diametro",
    strokeLabel: "Carrera",
    cylindersLabel: "Cilindros",
    baselineLabel: "Base cc (opcional)",
    rodLengthLabel: "Longitud de biela",
    sprocketLabel: "Dientes delantero",
    crownLabel: "Dientes trasero",
    vehicleTypeLabel: "Tipo de vehiculo",
    rimLabel: "Llanta",
    widthLabel: "Ancho",
    aspectLabel: "Perfil",
    rimWidthLabel: "Ancho de llanta (opcional)",
    flotationLabel: "Medida flotation (opcional)",
    measureMetricLabel: "Metrico",
    measureFlotationLabel: "Flotation",
    Car: "Carro",
    Motorcycle: "Moto",
    LightTruck: "SUV/Pickup/Van",
    TruckCommercial: "Camion Comercial",
    Kart: "Kart",
    Kartcross: "Kartcross",
    required: "Requerido",
  },
};

const LanguageContext = createContext<I18nContextValue | null>(null);

export function LanguageProvider({ children }: { children: React.ReactNode }) {
  const [language, setLanguage] = useState<Language>("en_US");

  const value = useMemo<I18nContextValue>(() => {
    const dict = dictionaries[language];
    return {
      language,
      setLanguage,
      t: (key: string) => dict[key] || key,
    };
  }, [language]);

  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
}

export function useI18n(): I18nContextValue {
  const ctx = useContext(LanguageContext);
  if (!ctx) {
    throw new Error("useI18n must be used within LanguageProvider");
  }
  return ctx;
}
